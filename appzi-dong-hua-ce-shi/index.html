<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>tuyc - APP自动化测试</title>
    <meta name="description" content="">
    <meta name="author" content="tuyc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/theme/bootstrap.min.css" rel="stylesheet">
    <link href="/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="/theme/local.css" rel="stylesheet">
    <link href="/theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="">tuyc</a>

        <div class="nav-collapse">
        <ul class="nav">
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="/appzi-dong-hua-ce-shi/app-uiaotomator.html"><h1>APP自动化测试接入QA记录</h1></a>
六 23 九月 2017

by <a class="url fn" href="/author/tuyc.html">tuyc</a>
 


 
        </div>
        
        <div><p>[TOC]</p>
<h2>APP自动化测试接入遇到问题记录</h2>
<h3>Android Studio接入</h3>
<h4>依赖库接入</h4>
<div class="highlight"><pre><span></span>androidTestCompile &#39;com.android.support.test.uiautomator:uiautomator-v18:2.1.1&#39;
androidTestCompile &#39;junit:junit:4.12&#39;
androidTestCompile &#39;com.android.support.test:runner:0.4&#39;
androidTestCompile &#39;com.android.support.test:rules:0.4&#39;
</pre></div>


<p><strong>报错1:</strong></p>
<blockquote>
<p>Manifest merger failed : uses-sdk:minSdkVersion 16 cannot be smaller than version 18 declared in library [com.android.support.test.uiautomator:uiautomator-v18:2.1.1] /Users/tuyc/.android/build-cache/219ff6e8caee2036dd2b56eca058202441d74058/output/AndroidManifest.xml
      Suggestion: use tools:overrideLibrary="android.support.test.uiautomator.v18" to force usage</p>
</blockquote>
<p><strong>解决方法：</strong></p>
<p>只需要在androidTest目录下新建一个清单文件来解决问题。</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span>    <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
<span class="na">package=</span><span class="s">&quot;cn.cqwangshan.wst&quot;</span>    <span class="nt">&gt;</span>
<span class="nt">&lt;uses-sdk</span> <span class="na">tools:overrideLibrary=</span><span class="s">&quot;android.support.test.uiautomator.v18&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>


<p><strong>报错2：</strong></p>
<blockquote>
<p>Conflict with dependency 'com.android.support:support-annotations' in project ':lender-app:app'. Resolved versions for app (25.3.1) and test app (23.0.1) differ. See http://g.co/androidstudio/app-test-app-conflict for details.</p>
</blockquote>
<p><strong>解决方法：</strong></p>
<p>在build.gradle中configurations.all强制使用版本号。</p>
<div class="highlight"><pre><span></span>configurations.all {
    resolutionStrategy.force &#39;com.android.support:support-annotations:25.3.1&#39;
}
</pre></div>


<blockquote>
<p>注：以上方式每次启动编译时间太长，感觉效率太低。以上方式没有深究，因为发现更好的Python语言的uiautomator框架。</p>
</blockquote>
<h3>Python uiautomator接入</h3>
<blockquote>
<p>初窥：简直酷炫到没有朋友！完全模拟用户行为！</p>
</blockquote>
<p>该框架接入非常顺利，没有遇到什么问题。安装以及API使用请参考https://github.com/xiaocong/uiautomator</p>
<h4>酷炫在哪里？</h4>
<ul>
<li><strong>完全模拟用户行为</strong>
  开屏，锁屏，应用启动按钮点击等，全部模拟真实用户操作。不依赖需要测试APP的任何信息。</li>
</ul>
<p>比如appium（接下来会介绍）会依赖包名，启动页面等一些列信息，限制较高，坑也较多。</p>
<ul>
<li><strong>可测试当前打开页面</strong></li>
</ul>
<p>可以启动APP到指定页面，然后运行从这个页面开始的脚本。这个功能效果其实是基于第一点的充分补充。</p>
<p>比如appium会每次重新启动APP，如果测试的位置太深，等到这个位置估计时间就得花很久了。而且每次写脚本需要调试，估计够呛！</p>
<h4>UI元素获取</h4>
<p>适用Android SDK中的tools目录下的uiautomator工具抓取即可。</p>
<p>如图：</p>
<p><img alt="WX20170923-095807@2x" src="images/WX20170923-095807@2x.png" /></p>
<h4>缺点</h4>
<p>仅仅适用于Android APP，iOS不支持</p>
<h4>58同城APP测试示例</h4>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3.5</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">uiautomator</span> <span class="kn">import</span> <span class="n">device</span> <span class="k">as</span> <span class="n">d</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">ScreenGesture</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">swipLeft</span><span class="p">():</span>
        <span class="n">d</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">swipTop</span><span class="p">():</span>
        <span class="n">d</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">swipRight</span><span class="p">():</span>
        <span class="n">d</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">swipBottom</span><span class="p">():</span>
        <span class="n">d</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Mytest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c1"># 初始化工作</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;--------------初始化工作&quot;</span><span class="p">)</span>

    <span class="c1"># 退出清理工作</span>
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;--------------退出清理工作&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">ScreenGesture</span><span class="o">.</span><span class="n">swipTop</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">press</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;应用&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">d</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;应用&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">maxPage</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxPage</span><span class="p">):</span>
            <span class="n">ScreenGesture</span><span class="o">.</span><span class="n">swipRight</span><span class="p">()</span>

        <span class="n">launchIcon</span> <span class="o">=</span> <span class="n">d</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;58同城&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxPage</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">launchIcon</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ScreenGesture</span><span class="o">.</span><span class="n">swipLeft</span><span class="p">()</span>

        <span class="n">d</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;58同城&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">d</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;android.widget.TextView&quot;</span><span class="p">,</span> <span class="n">resourceId</span><span class="o">=</span><span class="s1">&#39;com.wuba:id/home_tab_title&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">d</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;android.widget.ImageView&quot;</span><span class="p">,</span> <span class="n">resourceId</span><span class="o">=</span><span class="s1">&#39;com.wuba:id/mycenter_head_image&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;android.widget.EditText&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;15957139230&#39;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;android.widget.EditText&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;12345678&#39;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;登录&#39;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s1">&#39;android.widget.Button&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<h3>Python appium接入——Android篇</h3>
<h4>优势</h4>
<p>跨平台</p>
<h4>appium连接手机</h4>
<h5>下载安装appium</h5>
<div class="highlight"><pre><span></span>建议下载客户端
</pre></div>


<p><strong>查看手机iP和端口</strong></p>
<div class="highlight"><pre><span></span>先运行adb shell  ，然后运行netstat
</pre></div>


<h5>查看手机udid</h5>
<div class="highlight"><pre><span></span>adb devices
</pre></div>


<div class="highlight"><pre><span></span># 执行结果 9ca23118就是设备的udid
List of devices attached
80QBCPF22FDH    device
</pre></div>


<h5>查看APP启动Activity</h5>
<div class="highlight"><pre><span></span># 打开APP在启动页，执行以下命令即可
adb shell dumpsys activity | grep mFocusedActivity
</pre></div>


<p><strong>报错1：（连接手机报错）</strong></p>
<div class="highlight"><pre><span></span>{
    &quot;platformName&quot;:&quot;Android&quot;,
    &quot;platformVersion&quot;:&quot;5.1.1&quot;,
    &quot;deviceName&quot;:&quot;80QBCPF22FDH&quot;,
    &quot;udid&quot;:&quot;80QBCPF22FDH&quot;,
    &quot;appPackage&quot;:&quot;com.wuba&quot;,
    &quot;appActivity&quot;:&quot;com.wuba.activity.launch.LaunchActivity&quot;
}
</pre></div>


<div class="highlight"><pre><span></span>Error
Traceback (most recent call last):
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/urllib/request.py&quot;, line 1240, in do_open
    h.request(req.get_method(), req.selector, req.data, headers)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 1083, in request
    self._send_request(method, url, body, headers)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 1128, in _send_request
    self.endheaders(body)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 1079, in endheaders
    self._send_output(message_body)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 911, in _send_output
    self.send(msg)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 854, in send
    self.connect()
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/client.py&quot;, line 826, in connect
    (self.host,self.port), self.timeout, self.source_address)
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socket.py&quot;, line 711, in create_connection
    raise err
  File &quot;/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socket.py&quot;, line 702, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused
</pre></div>


<p><strong>解决方案：</strong></p>
<p>原因：appium服务没有启动起来</p>
<p>启动appium客户端，配置参数，Launch即可</p>
<p><strong>报错2：（appium1.5.3客户端连接手机抓取元素信息 inspector）</strong></p>
<div class="highlight"><pre><span></span>could not launch appium inspector
</pre></div>


<p><strong>解决方案：</strong></p>
<div class="highlight"><pre><span></span>appium1.5.3没有维护
下载release版https://github.com/appium/appium-desktop/releases
</pre></div>


<p>配置如下（一个都不能少）：</p>
<div class="highlight"><pre><span></span>{
    &quot;platformName&quot;:&quot;Android&quot;,
    &quot;platformVersion&quot;:&quot;5.1.1&quot;,
    &quot;deviceName&quot;:&quot;80QBCPF22FDH&quot;,
    &quot;udid&quot;:&quot;80QBCPF22FDH&quot;,
    &quot;appPackage&quot;:&quot;com.wuba&quot;,
    &quot;appActivity&quot;:&quot;com.wuba.activity.launch.LaunchActivity&quot;
}
</pre></div>


<p><img alt="WX20170921-201820" src="../github/blog/tuyc/content/images/WX20170921-201820.png" /></p>
<p>其他属性可以参考：https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/caps.md</p>
<p><strong>报错3（appium 连接真机问题）</strong></p>
<div class="highlight"><pre><span></span><span class="nt">selenium</span><span class="nc">.common.exceptions.WebDriverException</span><span class="o">:</span> <span class="nt">Message</span><span class="o">:</span> <span class="nt">A</span> <span class="nt">new</span> <span class="nt">session</span> <span class="nt">could</span> <span class="nt">not</span> <span class="nt">be</span> <span class="nt">created</span><span class="o">.</span> <span class="nt">Details</span><span class="o">:</span> <span class="nt">Problem</span> <span class="nt">getting</span> <span class="nt">session</span> <span class="nt">data</span> <span class="nt">for</span> <span class="nt">driver</span> <span class="nt">type</span> <span class="nt">AndroidDriver</span><span class="o">;</span> <span class="nt">does</span> <span class="nt">it</span> <span class="nt">implement</span> <span class="s1">&#39;get driverData&#39;</span><span class="o">?</span>
</pre></div>


<p><strong>解决方案：</strong></p>
<p>已经有个appium inspector在跑了，就是前面使用appium客户端配置的跑起来的，需要关掉即可。</p>
<p>python的连接代码（一个不能少）：</p>
<div class="highlight"><pre><span></span><span class="n">desired_caps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;platformName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Android&#39;</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;platformVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;5.1.1&#39;</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;deviceName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;80QBCPF22FDH&#39;</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;udid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;80QBCPF22FDH&#39;</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;appPackage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;com.wuba&#39;</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;appActivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;com.wuba.activity.launch.LaunchActivity&#39;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">(</span><span class="s1">&#39;http://localhost:4723/wd/hub&#39;</span><span class="p">,</span> <span class="n">desired_caps</span><span class="p">)</span>
</pre></div>


<h4>58同城示例</h4>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3.5</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Android environment</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">appium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">PATH</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">ScreenGesture</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">swipLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.driver.swipe(self.width-100, self.height/2, 100, self.height/2, duration=1000)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">flick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swipTop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swipRight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swipBottom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ContactsAndroidTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">desired_caps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;platformName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Android&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;platformVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;7.0&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;deviceName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;80QBCPF22FDH&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;udid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;9ca23118&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;appPackage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;com.wuba&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;appActivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;com.wuba.activity.launch.LaunchActivity&#39;</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;unicodeKeyboard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;resetKeyboard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># 不会清除缓存</span>
        <span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;noReset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">(</span><span class="s1">&#39;http://localhost:4723/wd/hub&#39;</span><span class="p">,</span> <span class="n">desired_caps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;清理工作&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_activity</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//*[@text=&#39;我的&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//*[@resource-id=&#39;com.wuba:id/mycenter_head_image&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">textfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_class_name</span><span class="p">(</span><span class="s2">&quot;android.widget.EditText&quot;</span><span class="p">)</span>
        <span class="n">textfields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">textfields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;15957139126&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">press_keycode</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">textfields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;aA113520&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">hide_keyboard</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//*[@text=&#39;登录&#39;][@class=&#39;android.widget.Button&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestLoader</span><span class="p">()</span><span class="o">.</span><span class="n">loadTestsFromTestCase</span><span class="p">(</span><span class="n">ContactsAndroidTests</span><span class="p">)</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>


<h4>Python appium接口</h4>
<p><strong>问题1：（寻找元素问题</strong>find_element_by_android_uiautomator<strong>）</strong></p>
<div class="highlight"><pre><span></span>An unknown server-side error occurred while processing the command.
</pre></div>


<p><strong>解决方案：</strong></p>
<p>原因：使用API方式不对。</p>
<p>将</p>
<div class="highlight"><pre><span></span>self.driver.find_element_by_android_uiautomator(&#39;允许&#39;).click()
</pre></div>


<p>改为</p>
<div class="highlight"><pre><span></span>self.driver.find_element_by_android_uiautomator(&#39;new UiSelector().text(&quot;允许&quot;)&#39;).click()
</pre></div>


<p><strong>问题2：（寻找元素问题find_element_by_name）</strong></p>
<div class="highlight"><pre><span></span>selenium.common.exceptions.InvalidSelectorException: Message: Locator Strategy &#39;name&#39; is not supported for this session
</pre></div>


<p><strong>解决方案：</strong></p>
<p>将</p>
<div class="highlight"><pre><span></span>self.driver.find_element_by_name(&quot;允许&quot;).click()
# 该方法已经在高版本弃用
</pre></div>


<p>改为</p>
<div class="highlight"><pre><span></span>self.driver.find_element_by_xpath(&quot;//*[@text=&#39;允许&#39;]&quot;).click()
# 注：@符号其实是在找属性。对应attrobute中text=&#39;允许&#39;的元素
</pre></div>


<p><strong>问题3：（滑动问题 </strong>swipe<strong>）</strong></p>
<div class="highlight"><pre><span></span>self.driver.swipe(800, 200, 0, 200, duration=10) 失效
</pre></div>


<p><strong>解决方案：</strong></p>
<div class="highlight"><pre><span></span><span class="err">改为：</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">duration</span><span class="err">设置太小，没有效果。单位是</span><span class="n">ms</span>

<span class="err">滑动方案：</span>
<span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
<span class="c1"># 方法1：</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">swipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="c1"># 方法2：flick(self, start_x, start_y, end_x, end_y) end_x其实代表的是dx,end_y代表的是dx</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">flick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># 建议使用方法2，会更丝滑哦</span>
</pre></div>


<p><strong>问题4：(设值问题</strong>send_keys<strong>)</strong></p>
<div class="highlight"><pre><span></span>{WebDriverException}Message: Parameters were incorrect. We wanted {&quot;required&quot;:[&quot;value&quot;]} and you sent [&quot;value&quot;,&quot;id&quot;,&quot;sessionId&quot;,&quot;text&quot;]
</pre></div>


<p><strong>解决方案：</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># 使用driver的set_value方法</span>
<span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="c1"># 示例</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">textfields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;15957139230&#39;</span><span class="p">)</span>
</pre></div>


<p><strong>问题5：(模拟键盘事件）</strong></p>
<p><strong>解决方案：</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># keycode 查询地址https://developer.android.com/reference/android/view/KeyEvent.html</span>
<span class="c1"># KeyEvent --&gt; public static final int KEYCODE_ENTER = 66;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">textfields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;15957139230&#39;</span><span class="p">)</span>
<span class="c1"># 模拟点击手机键盘Enter键</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">press_keycode</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>
</pre></div>


<p>注意事项：</p>
<div class="highlight"><pre><span></span><span class="c1"># 需要使用键盘事件的时候，driver连接的时候需要添加以下属性 </span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;unicodeKeyboard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">desired_caps</span><span class="p">[</span><span class="s1">&#39;resetKeyboard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<blockquote>
<p>未完待续</p>
</blockquote></div>
        <hr />
    </div>
		
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="/appzi-dong-hua-ce-shi/index.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="/archives.html">Archives</a>
                <li><a href="/tags.html">Tags</a>




            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="/android-animation/index.html">Android Animation</a></li>
                <li><a href="/android-material-design/index.html">Android Material Design</a></li>
                <li><a href="/appzi-dong-hua-ce-shi/index.html">APP自动化测试</a></li>
                <li><a href="/misc/index.html">misc</a></li>
                <li><a href="/xian-cheng/index.html">线程</a></li>
                <li><a href="/yuan-ma-zou-du/index.html">源码走读</a></li>
                   
            </ul>
            </div>
            


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://getpelican.com/">Pelican</a></li>
                <li><a href="http://python.org/">Python.org</a></li>
                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://www.infoq.com/">InfoQ</a></li>
                <li><a href="http://gityuan.com/">Gityuan</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="">tuyc</a> &copy; tuyc 2017</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="/theme/bootstrap-collapse.js"></script>
 
</body>
</html>